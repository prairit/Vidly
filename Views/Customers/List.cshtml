@model IEnumerable<Vidly.Models.Customer>
@{
    ViewBag.Title = "List";
}

<h2>List of Customers</h2>
@Html.ActionLink("New Customer","New","Customers",new{@class="btn btn-primary mb-5"})
<table id="customers"class="table table-hover table-bordered">
    <tr>
        <th>Name</th>
        <th>Membership Type</th>
        <th>Delete</th>
    </tr>
    @if (Model.Count() == 0)
    {
        <tr><td>There are no customers to display.</td></tr>
    }
    else
    {
        foreach (var customer in Model)
        {
            <tr><td>@Html.ActionLink(customer.Name, "Edit", "Customers", new {id = customer.Id}, null)</td>
                <td>@customer.MembershipType.Name</td>
                <td> <button data-customer-id="@customer.Id" class="btn-link js-delete">Delete</button> </td>
            </tr>
        }
    }
</table>

@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#customers .js-delete").click(function () {
                var btn = $(this);
                if (confirm("Are you sure you want to delete this customer??")) {
                    console.log(btn.attr("data-customer-id"));
                    $.ajax
                    ({
                        url: "/api/customers/" + btn.attr("data-customer-id"),
                        method: "DELETE",
                        success: function () {
                            btn.parents("tr").remove();
                        }

                    });
                }
            });
        });
    </script>
}

